# 公共词库数据清理工具

## 功能说明

此工具用于清理公共词库（`public_vocabulary_words` 表）中格式不符的单词记录，确保单词字段只包含英文字母、连字符、撇号和空格。

## 问题示例

以下是需要清理的不规范数据示例：
- `excess n超过；过多` - 单词字段包含中文
- `excessive 超出的` - 单词字段包含中文
- `123test` - 单词字段包含数字
- `测试word` - 单词字段包含中文

## ⚠️ 重要说明

**请使用独立版本脚本**: `clean_public_words_standalone.py`

这个版本不依赖 app 框架，避免了模型冲突问题，运行更快更稳定。

## 使用方法

### 1. 查看统计信息（不执行清理）

```bash
cd py
python clean_public_words_standalone.py --stats
```

这会显示：
- 按语言分类的单词数量
- 总单词数
- 格式正确和格式错误的记录数量及百分比

### 2. 交互式清理（推荐）

```bash
cd py
python clean_public_words_standalone.py
```

脚本会：
1. 扫描所有公共词库记录
2. 显示不规范记录的数量和示例
3. 询问是否确认删除
4. 执行删除操作
5. 显示清理结果统计

### 3. 强制清理（不询问确认）

```bash
cd py
python clean_public_words_standalone.py --force
```

⚠️ **注意**: 此模式会直接删除不规范记录，不会询问确认，请谨慎使用！

## 验证规则

单词字段必须满足以下条件：
- ✅ 只包含英文字母（a-z, A-Z）
- ✅ 可以包含连字符（-）：如 `self-control`
- ✅ 可以包含撇号（'）：如 `don't`
- ✅ 可以包含空格：如 `ice cream`
- ❌ 不能包含中文字符
- ❌ 不能包含数字
- ❌ 不能包含其他特殊符号

## 示例输出

```
============================================================
开始清理公共词库数据...
============================================================

总记录数: 1500

发现不符合规范的记录数: 45

不规范记录示例（前10个）:
------------------------------------------------------------
1. ID: 123, 单词: 'excess n超过；过多', 语言: en
2. ID: 456, 单词: 'excessive 超出的', 语言: en
...

============================================================
是否删除这 45 条不规范记录? (yes/no): yes

开始删除不规范记录...
已删除 45/45 条记录...

============================================================
清理完成！
============================================================
原始记录数: 1500
删除记录数: 45
剩余记录数: 1455
清理率: 3.00%
```

## 注意事项

1. **备份数据**: 在执行清理前，建议先备份数据库
2. **测试环境**: 建议先在测试环境中运行，确认无误后再在生产环境执行
3. **权限要求**: 需要数据库写权限
4. **不可恢复**: 删除操作不可恢复，请谨慎操作

## 安全建议

1. 先运行 `--stats` 查看统计信息
2. 检查不规范记录示例，确认删除逻辑正确
3. 使用交互式模式进行首次清理
4. 清理后再次运行 `--stats` 验证结果

## 故障排除

### 问题：模型冲突错误

**错误信息**: `Multiple classes found for path "VocabularyWord"`

**解决方案**: 使用独立版本脚本

```bash
# ❌ 不要用这个
python clean_public_words.py

# ✅ 用这个
python clean_public_words_standalone.py
```

### 问题：导入模块失败

**解决方案**: 确保在 `py` 目录下运行脚本

```bash
cd d:\基于IPv6的AI智能学习伴侣导师\基于IPv6的AI智能学习伴侣导师8.1\py
python clean_public_words_standalone.py
```

### 问题：数据库连接失败

**解决方案**: 检查脚本中的数据库连接字符串

打开 `clean_public_words_standalone.py`，找到这一行：
```python
DATABASE_URL = "mysql+pymysql://root:123456@localhost/ipv6_education"
```

根据您的实际情况修改：
- 用户名：`root`
- 密码：`123456`
- 主机：`localhost`
- 数据库名：`ipv6_education`

### 问题：权限不足

**解决方案**: 确保数据库用户有删除权限

## 相关文件

- `clean_public_words_standalone.py` - **独立清理脚本（推荐使用）**
- `clean_public_words.py` - 依赖app框架的版本（不推荐，有模型冲突问题）
- `models/language_learning.py` - 数据模型定义
- `database.py` - 数据库连接配置

## 两个版本的区别

| 特性 | standalone版本 | 原版本 |
|------|---------------|--------|
| 依赖 | 仅依赖SQLAlchemy | 依赖完整app框架 |
| 启动速度 | 快（约1秒） | 慢（约10秒） |
| 模型冲突 | ✅ 无 | ❌ 有 |
| 推荐度 | ⭐⭐⭐⭐⭐ | ⭐⭐ |

